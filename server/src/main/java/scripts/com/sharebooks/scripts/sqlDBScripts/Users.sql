DROP TABLE IF EXISTS Users;

CREATE TABLE Users (
	id BIGINT(19) UNSIGNED AUTO_INCREMENT,
	username VARCHAR(50) NOT NULL UNIQUE,
	password VARCHAR(20) NOT NULL,
	name VARCHAR(40) NOT NULL,
	birthDate DATE NOT NULL,
	age INT,
	contactNo VARCHAR(10) NOT NULL UNIQUE,
	active TINYINT NOT NULL DEFAULT 1,
	creationTime DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	lastModificationTime DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (id)
) ENGINE=INNODB;




DELIMITER $$
CREATE TRIGGER before_user_insert
	BEFORE INSERT ON Users
	FOR EACH ROW
	BEGIN
		IF (NEW.username REGEXP '^[A-Z0-9]+[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,20}$') = 0 THEN
			SIGNAL SQLSTATE '45000'
				SET MESSAGE_TEXT = 'Username is not in correct format.';
		END IF;
	END;
$$
DELIMITER ;



